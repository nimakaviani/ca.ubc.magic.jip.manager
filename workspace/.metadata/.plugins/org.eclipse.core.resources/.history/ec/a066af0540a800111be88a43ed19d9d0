package com.jchapman.jipsnapman.events;

import java.io.IOException;
import java.io.PrintWriter;
import java.io.StringWriter;
import java.text.MessageFormat;

import jipplugin.Activator;

import models.Constants;

import org.yasl.arch.action.YASLActionHandler;
import org.yasl.arch.impl.event.YASLActionEvent;
import org.yasl.arch.resources.YASLResourceManager;

import com.jchapman.jipsnapman.utils.JIPSnapManConstants;

public class
EventLogger 
{
	///////////////////////////////////////////////////////////////////////////////
	//	Used by start/stop
	///////////////////////////////////////////////////////////////////////////////
	
	// log any exceptions thrown
	protected void 
	updateConsoleLog
	(Exception ex)
	throws IOException 
	{
		StringWriter swriter
		= new StringWriter();
		ex.printStackTrace(new PrintWriter(swriter));
		swriter.flush();
		swriter.close();
		updateConsoleLog(swriter.toString());
	}
		
	// log missing data dialog window errors
	protected EventLogEvent 
	getErrorEvent() 
	{
		EventLogEvent event 
			= new EventLogEvent(
				this,
				EventLogEvent.ACTION_PERFORMED,
				""
			);
		event.setProperty(Constants.KEY_ERR_DLGTITLE,
		"dlg.title.missing");
		return event;
	}
	
	// log a successful event
	protected void 
	updateForSuccessfulCall
	(String call) 
	throws IOException 
	{
		StringBuffer buf
			= new StringBuffer();
		buf.append(MessageFormat.format(
			"The {0} call was successful.",
			new Object[] {call})
		);
		buf.append('\n');
		
		updateConsoleLog(buf.toString());
	}
	
	// write to the event log: main work horse
	protected void 
	updateConsoleLog
	(String message) 
	throws IOException
	{
		EventLogEvent event 
		= new EventLogEvent(
				this,
				EventLogEvent.ACTION_PERFORMED,
				""
			);
		event.setProperty(Constants.KEY_LOGS_DATA, message);
		EventLogActionHandler action_handler
			= Activator.getDefault().getActionHandler();
		action_handler.performActionByKey(
			Constants.ACTKEY_LOG_DISPLAY,
			event
		);
	}

}
